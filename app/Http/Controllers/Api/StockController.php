<?php
/*
 本代码由 PHP代码加密工具 Xend(Build 5.00.08) 创建
 创建时间 2019-04-23 14:56:54
 技术支持 QQ:30370740 Mail:support@phpXend.com
 严禁反编译、逆向等任何形式的侵权行为，违者将追究法律责任
*/

namespace App\Http\Controllers\Api;use function Couchbase\defaultDecoder;use Illuminate\Http\Request;use Illuminate\Support\Facades\DB;use App\Models\Shares;class StockController extends Controller{public function index(Request $request){$page=$request->page;$limit=10;$H2t0=$page-1;$page=$H2t0;$H2t0=!$page;if($H2t0)goto H2tBodyx2;goto H2tNextx2;H2tBodyx2:$page=0;goto H2tx1;H2tNextx2:H2tx1:$H2t0=$page*$limit;$offset=$H2t0;$shares=DB::table('shares')->offset($offset)->limit($limit)->select('code')->get();$plucked=$shares->pluck('code');$plucked->all();$plucked=$plucked->implode(',');$list=get_price_moneys($plucked);if($list)goto H2tBodyx4;goto H2tNextx4;H2tBodyx4:return ['status'=>true,'data'=>$list];goto H2tx3;H2tNextx4:return ['status'=>false,'msg'=>'没有股票'];H2tx3:}public function search(Request $request){$code=$request->code;$shares=collect([]);if($code)goto H2tBodyx6;goto H2tNextx6;H2tBodyx6:$shares=Db::table('shares')->select('code','name')->limit(10)->orwhere('code','like',"%".$code."%")->orwhere('name','like',"%".$code."%")->get();goto H2tx5;H2tNextx6:H2tx5:$codes=$shares->implode('code',',');$goods=getRealTimeInfos($codes);$new_shares=$shares->map(function($item)use($goods){if(isset($goods[$item->code])){$item->current_price=$goods[$item->code]['current_price'];$item->up_ratio=$goods[$item->code]['up_ratio'];}return $item;});return ['status'=>true,'data'=>$new_shares];}public function show(Request $request){$code=$request->code;$H2t0=!$code;if($H2t0)goto H2tBodyx8;goto H2tNextx8;H2tBodyx8:return ['status'=>false,'msg'=>"股票代码必须"];goto H2tx7;H2tNextx8:H2tx7:$prices=get_price_moneys($code);if($prices)goto H2tBodyxa;goto H2tNextxa;H2tBodyxa:return ['status'=>true,'data'=>$prices];goto H2tx9;H2tNextxa:H2tx9:}public function getprice(Request $request){$code=$request->code;$price=get_price_moneys($code);$shares=Shares::where('code',$code)->first();$H2t0=!$shares;if($H2t0)goto H2tBodyxc;goto H2tNextxc;H2tBodyxc:return ['status'=>false,'msg'=>'当前股票不存在！'];goto H2txb;H2tNextxc:H2txb:if($price)goto H2tBodyxe;goto H2tNextxe;H2tBodyxe:$price['is_danger']=$shares['is_danger'];return ['status'=>true,'data'=>$price];goto H2txd;H2tNextxe:return ['status'=>false,'msg'=>"当前信息不存在"];H2txd:}public function getRealTimeInfos($code){return getRealTimeInfos($code);}public function getRealTimeInfo($code){return getRealTimeInfo($code);}public function getKLine($type,$code){$response=[];$urls=["hourly"=>"http://data.gtimg.cn/flashdata/hushen/minute/".$code.".js","daily"=>"http://data.gtimg.cn/flashdata/hushen/latest/daily/".$code.".js","weekly"=>"http://data.gtimg.cn/flashdata/hushen/latest/weekly/".$code.".js","monthly"=>"http://data.gtimg.cn/flashdata/hushen/monthly/".$code.".js",];$H2t0=!array_key_exists($type,$urls);if($H2t0)goto H2tBodyxg;goto H2tNextxg;H2tBodyxg:return false;goto H2txf;H2tNextxg:H2txf:$url=$urls[$type];$res=@file_get_contents($url);$data=explode('\n\\'.PHP_EOL,$res);array_splice($data,0,2);array_splice($data,-1);$H2t0=$type=='hourly';if($H2t0)goto H2tBodyxi;goto H2tNextxi;H2tBodyxi:foreach($data as $v){$tmp=explode(' ',$v);$tmp[0]=substr_replace($tmp[0],'-',2,0);$tmp=array_map('floatval',$tmp);$response[]=$tmp;$H2t0=$tmp;}goto H2txh;H2tNextxi:foreach($data as $v){$tmp=explode(' ',$v);array_pop($tmp);$tmp=array_map('floatval',$tmp);$response[]=$tmp;$H2t0=$tmp;}H2txh:return $response;}}
?>